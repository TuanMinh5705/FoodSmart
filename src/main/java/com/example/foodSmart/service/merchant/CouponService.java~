package com.example.foodSmart.service.merchant;

import com.example.foodSmart.model.admin.Voucher;
import com.example.foodSmart.model.merchant.Coupon;
import com.example.foodSmart.util.ConnectDB;

import java.sql.*;
import java.util.ArrayList;
import java.util.List;

public class CouponService implements ICouponSerice {
    private static final String LIST_COUPONS_QUERY = "SELECT * FROM store_coupons order by coupon_id desc";
    private static final String ADD_COUPON_QUERY = "INSERT INTO store_coupons (store_id, coupon_code, discount_value, start_date, end_date, start_time, end_time, quantity, description) VALUES (?,?,?,?,?,?,?,?,?)";

    @Override
    public List<Coupon> getListCoupons() {
        List<Coupon> coupons = new ArrayList<>();
        try (Connection conn = ConnectDB.getConnection();
             PreparedStatement pstm = conn.prepareStatement(LIST_COUPONS_QUERY)) {
            ResultSet rs = pstm.executeQuery();
            while (rs.next()) {
                int coupon_id = rs.getInt(1);
                int store_id = rs.getInt(2);
                String coupon_code = rs.getString(3);
                int discount_value = rs.getInt(4);
                Timestamp start_date = rs.getTimestamp(5);
                Timestamp end_date = rs.getTimestamp(6);
                Time start_time = rs.getTime(7);
                Time end_time = rs.getTime(8);
                int quantity = rs.getInt(9);
                String description = rs.getString(10);
                Coupon coupon = new Coupon(coupon_id, store_id, coupon_code, discount_value, start_date, end_date, start_time, end_time, quantity, description);
                coupons.add(coupon);
            }
            return coupons;
        } catch (SQLException e) {
            throw new RuntimeException(e);
        }
    }

    @Override
    public void addCoupon(Coupon coupon) {
        try (Connection conn = ConnectDB.getConnection();
             PreparedStatement pstm = conn.prepareStatement(ADD_COUPON_QUERY)) {
            pstm.setInt(1,coupon.getStore_id());

        } catch (SQLException e) {
            throw new RuntimeException(e);
        }


    }

}
